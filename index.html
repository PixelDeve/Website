<!DOCTYPE html><html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spike — The Next-Gen Social</title>
  <meta name="description" content="Spike - A beautiful, modern social platform better than Reddit." />  <!-- TailwindCSS CDN -->  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />  <!-- Google Fonts: Poppins -->  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet" />  <style>
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #e0e7ff; }
    ::-webkit-scrollbar-thumb { background-color: #4f46e5; border-radius: 10px; border: 2px solid #e0e7ff; }
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #c7d2fe 0%, #a5b4fc 100%); color: #1f2937; min-height: 100vh; }
    a { transition: all 0.3s ease; }
    a:hover { color: #6366f1; }
  </style>  <!-- Firebase SDKs -->  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-analytics.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, getDoc, query, orderBy, serverTimestamp, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAPbvxBU0PYdgrHdHKCeqNAdiX0f-BdftY",
      authDomain: "pichat-b1206.firebaseapp.com",
      databaseURL: "https://pichat-b1206-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "pichat-b1206",
      storageBucket: "pichat-b1206.appspot.com",
      messagingSenderId: "844622847426",
      appId: "1:844622847426:web:...",
      measurementId: "G-20QPP0S27J"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    let currentUser = null;

    // DOM
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const userDisplay = document.getElementById('userDisplay');
    const postForm = document.getElementById('postForm');
    const postInput = document.getElementById('postInput');
    const postFeed = document.getElementById('postFeed');
    const loadingSpinner = document.getElementById('loadingSpinner');

    // Auth
    signIn = async ()=>{ try{ await signInWithPopup(auth, provider);}catch(e){alert(e.message);} };
    signUserOut = async ()=>{ await signOut(auth); };
    onAuthStateChanged(auth, user=>{ currentUser=user; renderUser(user); });

    function renderUser(user){
      if(user){
        userDisplay.textContent = user.displayName;
        loginBtn.classList.add('hidden'); logoutBtn.classList.remove('hidden'); postForm.classList.remove('hidden');
        loadPosts();
      } else {
        userDisplay.textContent = '';
        loginBtn.classList.remove('hidden'); logoutBtn.classList.add('hidden'); postForm.classList.add('hidden');
        postFeed.innerHTML = '<p class="text-center text-gray-500 mt-10">Please log in to see posts.</p>';
      }
    }

    // Load posts
    async function loadPosts(){
      loadingSpinner.classList.remove('hidden'); postFeed.innerHTML='';
      const q = query(collection(db,'posts'), orderBy('createdAt','desc'));
      const snap = await getDocs(q);
      if(snap.empty){ postFeed.innerHTML='<p class="text-center text-gray-500 mt-10">No posts yet!</p>'; loadingSpinner.classList.add('hidden'); return; }
      snap.forEach(docSnap=> postFeed.appendChild(makePostEl(docSnap.id, docSnap.data())));
      loadingSpinner.classList.add('hidden');
    }

    // Create post element
    function makePostEl(id, post){
      const el = document.createElement('div'); el.className='bg-white rounded-lg shadow-lg p-5 mb-6';
      el.innerHTML = `
        <div class="flex justify-between">
          <h3 class="font-semibold text-gray-800 text-lg">${escapeHtml(post.content)}</h3>
          <button class="text-sm text-gray-500 upvotes" data-id="${id}">${post.upvotes||0} ▲</button>
        </div>
        <p class="text-gray-500 text-xs mt-1">by <strong>${escapeHtml(post.authorName)}</strong> • ${post.createdAt? new Date(post.createdAt.seconds*1000).toLocaleString():'just now'}</p>
        <button class="mt-3 text-indigo-600 text-sm toggle-comments" data-id="${id}">${post.commentsCount||0} comments</button>
        <div class="comments mt-3 hidden">
          <div class="comment-list space-y-2 mb-2"></div>
          <form class="comment-form flex space-x-2">
            <input type="text" placeholder="Add a comment..." class="flex-grow p-2 border border-gray-300 rounded" required />
            <button type="submit" class="px-3 py-1 bg-indigo-500 text-white rounded">Post</button>
          </form>
        </div>
      `;

      // Upvote
      el.querySelector('.upvotes').onclick = ()=> upvote(id);
      // Toggle comments
      el.querySelector('.toggle-comments').onclick = e=> toggleComments(id, el);
      return el;
    }

    function escapeHtml(t){ return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

    async function upvote(id){ if(!currentUser) return alert('Login to upvote'); const key=`v_${id}_${currentUser.uid}`; if(localStorage[key]) return alert('Already upvoted');
      await updateDoc(doc(db,'posts',id), {upvotes: increment(1)}); localStorage[key]=1; loadPosts(); }

    async function toggleComments(postId, postEl){
      const ctn=postEl.querySelector('.comments');
      if(ctn.classList.contains('hidden')){
        // load comments
        const listEl=ctn.querySelector('.comment-list'); listEl.innerHTML='';
        const snap=await getDocs(query(collection(db,'posts',postId,'comments'),orderBy('createdAt','asc')));
        snap.forEach(d=>{ const c=d.data(); const div=document.createElement('div'); div.className='p-2 bg-gray-100 rounded'; div.innerHTML=`<p class="text-gray-800 text-sm">${escapeHtml(c.text)}</p><p class="text-gray-500 text-xs">by <strong>${escapeHtml(c.authorName)}</strong></p>`; listEl.appendChild(div); });
        // comment form
        ctn.querySelector('.comment-form').onsubmit = async e=>{
          e.preventDefault(); const input=e.target[0]; const text=input.value.trim(); if(!text) return;
          await addDoc(collection(db,'posts',postId,'comments'),{ text, authorName:currentUser.displayName, authorId:currentUser.uid, createdAt:serverTimestamp() });
          // update count
          await updateDoc(doc(db,'posts',postId),{commentsCount: increment(1)});
          input.value=''; toggleComments(postId, postEl); // reload
        };
        ctn.classList.remove('hidden');
      } else {
        ctn.classList.add('hidden');
      }
    }

    // Post form
    document.addEventListener('DOMContentLoaded',()=>{
      loginBtn.onclick=signIn; logoutBtn.onclick=signUserOut;
      postForm.onsubmit=async e=>{
        e.preventDefault(); const c=postInput.value.trim(); if(!c)return;
        await addDoc(collection(db,'posts'),{content:c,authorName:currentUser.displayName,authorId:currentUser.uid,createdAt:serverTimestamp(),upvotes:0,commentsCount:0});
        postInput.value=''; loadPosts();
      };
    });
  </script></head>
<body class="flex flex-col min-h-screen">
  <!-- Navbar -->
  <nav class="bg-indigo-600 p-4 sticky top-0">
    <div class="max-w-4xl mx-auto flex justify-between items-center">
      <h1 class="text-white text-2xl font-bold">Spike</h1>
      <div class="flex items-center space-x-4">
        <span id="userDisplay" class="text-indigo-100"></span>
        <button id="loginBtn" class="bg-indigo-400 hover:bg-indigo-500 px-3 py-1 rounded">Sign In</button>
        <button id="logoutBtn" class="hidden bg-red-500 hover:bg-red-600 px-3 py-1 rounded">Sign Out</button>
      </div>
    </div>
  </nav>  <!-- Main -->  <main class="flex-grow max-w-4xl mx-auto p-4">
    <!-- New post -->
    <form id="postForm" class="hidden mb-6">
      <textarea id="postInput" rows="3" class="w-full p-2 border border-gray-300 rounded" placeholder="Share something..."></textarea>
      <button type="submit" class="mt-2 px-4 py-2 bg-indigo-500 text-white rounded">Post</button>
    </form>
    <div id="loadingSpinner" class="hidden text-center text-indigo-600">Loading posts...</div>
    <div id="postFeed"></div>
  </main>  <!-- Footer -->  <footer class="bg-indigo-600 p-4 text-center text-indigo-100">
    &copy; 2025 Spike
  </footer>
</body>
</html>
