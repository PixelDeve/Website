<!DOCTYPE html><html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Spike â€” The Next-Gen Social</title>
  <meta name="description" content="Spike - A modern social platform inspired by Reddit. Mobile-friendly, comments, upvotes." />  <!-- TailwindCSS CDN -->  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">  <!-- Google Fonts: Inter -->  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f6f7f8; color: #1a1a1b; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
  </style>  <!-- Firebase SDKs -->  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js";
    
    const firebaseConfig = {
      apiKey: "AIzaSyAPbvxBU0PYdgrHdHKCeqNAdiX0f-BdftY",
      authDomain: "pichat-b1206.firebaseapp.com",
      projectId: "pichat-b1206",
      storageBucket: "pichat-b1206.appspot.com",
      messagingSenderId: "844622847426",
      appId: "1:844622847426:web:d76521621977b1d1074a5b",
      measurementId: "G-20QPP0S27J"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    let currentUser = null;
    
    // DOM refs
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const userDisplay = document.getElementById('userDisplay');
    const postForm = document.getElementById('postForm');
    const postInput = document.getElementById('postInput');
    const postFeed = document.getElementById('postFeed');
    const loadingSpinner = document.getElementById('loadingSpinner');

    function renderUser(user) {
      if (user) {
        currentUser = user;
        userDisplay.textContent = user.displayName;
        loginBtn.classList.add('hidden');
        logoutBtn.classList.remove('hidden');
        postForm.classList.remove('hidden');
        loadPosts();
      } else {
        currentUser = null;
        userDisplay.textContent = '';
        loginBtn.classList.remove('hidden');
        logoutBtn.classList.add('hidden');
        postForm.classList.add('hidden');
        postFeed.innerHTML = '<p class="text-center text-gray-500 mt-6">Log in to view posts.</p>';
      }
    }
    onAuthStateChanged(auth, renderUser);

    async function signIn() {
      try { await signInWithPopup(auth, provider); }
      catch(e){alert('Login failed: '+e.message)}
    }
    async function signOutUser(){await signOut(auth)}

    loginBtn.addEventListener('click', signIn);
    logoutBtn.addEventListener('click', signOutUser);

    async function loadPosts(){
      loadingSpinner.classList.remove('hidden');
      postFeed.innerHTML = '';
      try {
        const q = query(collection(db,'posts'), orderBy('createdAt','desc'));
        const snaps = await getDocs(q);
        if (snaps.empty) {
          postFeed.innerHTML = '<p class="text-center text-gray-500 mt-6">No posts yet.</p>';
        } else {
          snaps.forEach(docSnap=>{
            postFeed.appendChild(makePost(docSnap.id, docSnap.data()));
          });
        }
      } catch(e){ postFeed.innerHTML = '<p class="text-red-500">Error loading posts.</p>'; }
      loadingSpinner.classList.add('hidden');
    }

    function makePost(id, data){
      const card = document.createElement('div');
      card.className = 'bg-white rounded-lg shadow mb-4 overflow-hidden';
      card.innerHTML = `
        <div class="px-4 py-2 flex items-center justify-between">
          <span class="font-medium text-sm text-gray-600">${escape(data.authorName)}</span>
          <span class="text-xs text-gray-400">${data.createdAt? new Date(data.createdAt.seconds*1000).toLocaleDateString() : ''}</span>
        </div>
        <div class="px-4 pb-2">
          <p class="text-gray-800 mb-2">${escape(data.content)}</p>
          <div class="flex items-center space-x-4 text-gray-600 text-sm">
            <button class="upvote-btn flex items-center" data-id="${id}">
              <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M3 10h4v6h6v-6h4l-7-7-7 7z"/></svg>
              <span>${data.upvotes||0}</span>
            </button>
            <button class="comment-toggle flex items-center" data-id="${id}">
              <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.387..." clip-rule="evenodd"/></svg>
              <span>${data.commentsCount||0}</span>
            </button>
          </div>
          <div class="comments-section mt-2 hidden">
            <div class="comments-list mb-2"></div>
            <form class="flex space-x-2">
              <input type="text" class="flex-grow p-2 border rounded text-sm" placeholder="Add a comment..." required>
              <button class="px-3 py-1 bg-blue-500 text-white rounded text-sm">Post</button>
            </form>
          </div>
        </div>
      `;
      // events
      card.querySelector('.upvote-btn').onclick = ()=> upvote(id);
      card.querySelector('.comment-toggle').onclick = async(e)=>{
        const sec = card.querySelector('.comments-section');
        sec.classList.toggle('hidden');
        if(!sec.classList.contains('hidden')) await loadComments(id, card.querySelector('.comments-list'));
      };
      card.querySelector('form').onsubmit = async e=>{
        e.preventDefault();
        const inp = e.target.querySelector('input');
        await addComment(id, inp.value);
        inp.value='';
        await incrementCount(id,'commentsCount');
        await loadComments(id, card.querySelector('.comments-list'));
      };
      return card;
    }

    function escape(str){return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

    async function upvote(id){
      if(!currentUser){alert('Login first');return}
      const key=`up_${id}_${currentUser.uid}`;
      if(localStorage.getItem(key)){alert('Already voted');return}
      await updateDoc(doc(db,'posts',id),{upvotes: increment(1)});
      localStorage.setItem(key,'1');
      loadPosts();
    }

    async function loadComments(postId, container){
      container.innerHTML = '';
      const q = query(collection(db,'posts',postId,'comments'),orderBy('createdAt','asc'));
      const snaps = await getDocs(q);
      if(snaps.empty){ container.innerHTML='<p class="text-gray-500">No comments</p>'; }
      snaps.forEach(d=>{
        const c = document.createElement('div');
        c.className='text-sm text-gray-700 mb-1';
        c.textContent=`${d.data().authorName}: ${d.data().text}`;
        container.appendChild(c);
      });
    }

    async function addComment(postId, text){
      if(!currentUser) return;
      await addDoc(collection(db,'posts',postId,'comments'),{text,authorName: currentUser.displayName,createdAt: serverTimestamp()});
    }

    async function incrementCount(id,field){
      await updateDoc(doc(db,'posts',id),{[field]:increment(1)});
    }

    postForm.addEventListener('submit', async e=>{
      e.preventDefault();
      if(!currentUser) return;
      const txt=postInput.value.trim(); if(!txt)return;
      await addDoc(collection(db,'posts'),{content:txt,authorName:currentUser.displayName,createdAt:serverTimestamp(),upvotes:0,commentsCount:0});
      postInput.value=''; loadPosts();
    });
  </script></head>
<body class="flex flex-col min-h-screen">
  <header class="bg-white shadow p-4 sticky top-0 z-50">
    <div class="max-w-md mx-auto flex items-center justify-between">
      <h1 class="text-xl font-bold text-black">Spike</h1>
      <div class="flex items-center space-x-2">
        <span id="userDisplay" class="text-sm text-gray-600"></span>
        <button id="loginBtn" class="px-3 py-1 bg-blue-500 text-white rounded text-sm">Sign In</button>
        <button id="logoutBtn" class="hidden px-3 py-1 bg-red-500 text-white rounded text-sm">Sign Out</button>
      </div>
    </div>
  </header>  <main class="flex-grow max-w-md mx-auto w-full p-4 space-y-4">
    <form id="postForm" class="hidden flex flex-col space-y-2">
      <textarea id="postInput" rows="3" class="p-2 border rounded resize-none text-sm" placeholder="What's on your mind?" required></textarea>
      <button class="self-end px-4 py-1 bg-blue-600 text-white rounded text-sm">Post</button>
    </form>
    <div id="loadingSpinner" class="hidden text-center text-gray-500">Loading...</div>
    <section id="postFeed"></section>
  </main>  <footer class="p-4 text-center text-gray-500 text-xs">
    &copy; 2025 Spike
  </footer>
</body>
             </html>
