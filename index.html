<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WhatsApp Clone with Firebase</title>
  <style>
    /* === RESET & BASE === */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: sans-serif; background: #e5ddd5; height: 100vh; overflow: hidden; }
    ul { list-style: none; }
    button { background: none; border: none; cursor: pointer; }

    /* === LAYOUT === */
    #app { display: flex; height: 100%; }
    #contacts { width: 30%; background: #f0f2f5; display: flex; flex-direction: column; border-right: 1px solid #ddd; }
    #chat    { flex: 1; display: flex; flex-direction: column; }

    /* === CONTACTS HEADER === */
    #contacts header { padding: 1rem; background: #ededed; display: flex; justify-content: space-between; align-items: center; }
    #contacts header h2 { font-size: 1.4rem; }
    #contacts header button { font-size: 1.5rem; color: #128C7E; }

    /* === CONTACTS SEARCH === */
    #contacts .search { margin: 0.5rem 1rem; position: relative; }
    #contacts .search input {
      width: 100%; padding: 0.5rem 2.5rem 0.5rem 0.75rem;
      border-radius: 1rem; border: 1px solid #ccc;
    }
    #contacts .search .icon {
      position: absolute; right: 1rem; top: 50%;
      transform: translateY(-50%); font-size: 1.1rem; color: #888;
    }

    /* === CONTACTS LIST === */
    #contacts-list { flex: 1; overflow-y: auto; }
    .contact {
      display: flex; align-items: center; padding: 0.75rem 1rem;
      cursor: pointer; transition: background .2s;
    }
    .contact:hover, .contact.active { background: #e6e6e6; }
    .contact img { width: 48px; height: 48px; border-radius: 50%; margin-right: .75rem; }
    .contact .info h3 { font-size: 1rem; margin-bottom: .2rem; }
    .contact .info p  { font-size: .85rem; color: #666; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }

    /* === CHAT HEADER === */
    #chat header {
      padding: 1rem; background: #f0f2f5; display: flex; align-items: center; border-bottom: 1px solid #ddd;
    }
    #chat header img { width: 40px; height: 40px; border-radius: 50%; margin-right: .75rem; }
    #chat header .info h3 { font-size: 1.1rem; }
    #chat header .info p  { font-size: .9rem; color: #666; }
    #chat header .actions { margin-left: auto; display: flex; gap: 1rem; }
    #chat header .actions button { font-size: 1.2rem; color: #666; }

    /* === CHAT BODY === */
    #chat-body {
      flex: 1; padding: 1rem; overflow-y: auto; background: #e5ddd5;
    }
    .message {
      max-width: 65%; margin-bottom: 1rem; padding: .75rem;
      border-radius: .5rem; position: relative; word-wrap: break-word;
      line-height: 1.3;
    }
    .sent     { background: #dcf8c6; margin-left: auto; }
    .received { background: #fff; margin-right: auto; }
    .message .timestamp {
      font-size: .7rem; color: #999;
      position: absolute; bottom: -1.2rem; right: .5rem;
    }

    /* === CHAT FOOTER === */
    #chat footer {
      padding: .5rem 1rem; background: #f0f2f5; display: flex; align-items: center; border-top: 1px solid #ddd;
    }
    #chat footer textarea {
      flex: 1; padding: .75rem; border-radius: 1rem; border: 1px solid #ccc;
      resize: none; height: 40px; font-size: .95rem;
    }
    #chat footer button.send {
      background: #128c7e; color: #fff; border-radius: 1rem; padding: .5rem 1rem; font-size: 1rem; margin-left: .5rem;
    }

    /* === SCROLLBAR === */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 4px; }
  </style>
</head>
<body>
  <div id="app">
    <div id="contacts">
      <header>
        <h2>Chats</h2>
        <button id="newChat">+</button>
      </header>
      <div class="search">
        <input type="text" id="search" placeholder="Search contacts‚Ä¶">
        <span class="icon">üîç</span>
      </div>
      <ul id="contacts-list"></ul>
    </div>

    <div id="chat">
      <header>
        <img src="" id="avatar" alt="">
        <div class="info">
          <h3 id="chatName">Select a chat</h3>
          <p id="chatStatus">Status</p>
        </div>
        <div class="actions">
          <button>üìû</button>
          <button>üé•</button>
          <button>‚ãÆ</button>
        </div>
      </header>

      <div id="chat-body"></div>

      <footer>
        <textarea id="messageInput" placeholder="Type a message"></textarea>
        <button class="send" id="sendBtn">Send</button>
      </footer>
    </div>
  </div>

  <script type="module">
    // --- Firebase imports ---
    import { initializeApp }     from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAnalytics }      from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
    import {
      getDatabase,
      ref,
      push,
      onChildAdded
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

    // --- Your Firebase config ---
    const firebaseConfig = {
      apiKey: "AIzaSyAPbvxBU0PYdgrHdHKCeqNAdiX0f-BdftY",
      authDomain: "pichat-b1206.firebaseapp.com",
      projectId: "pichat-b1206",
      storageBucket: "pichat-b1206.firebasestorage.app",
      messagingSenderId: "844622847426",
      appId: "1:844622847426:web:d76521621977b1d1074a5b",
      measurementId: "G-20QPP0S27J"
    };

    // --- Initialize Firebase ---
    const app       = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db        = getDatabase(app);

    // --- In‚Äëmemory Contacts (could also be stored in Firebase) ---
    class Contact {
      constructor(id, name, avatar) {
        this.id      = id;
        this.name    = name;
        this.avatar  = avatar;
        this.status  = 'online';
      }
    }

    const contacts = [
      new Contact(1, 'Alice',   'https://i.pravatar.cc/150?img=1'),
      new Contact(2, 'Bob',     'https://i.pravatar.cc/150?img=2'),
      new Contact(3, 'Charlie', 'https://i.pravatar.cc/150?img=3'),
      new Contact(4, 'Dave',    'https://i.pravatar.cc/150?img=4'),
      new Contact(5, 'Eve',     'https://i.pravatar.cc/150?img=5'),
    ];

    let activeContact = null;

    // --- Cache DOM ---
    const $contactsList  = document.getElementById('contacts-list');
    const $chatBody      = document.getElementById('chat-body');
    const $chatName      = document.getElementById('chatName');
    const $chatStatus    = document.getElementById('chatStatus');
    const $avatar        = document.getElementById('avatar');
    const $sendBtn       = document.getElementById('sendBtn');
    const $messageInput  = document.getElementById('messageInput');
    const $search        = document.getElementById('search');
    const $newChat       = document.getElementById('newChat');

    // --- Render Contacts ---
    function renderContacts() {
      $contactsList.innerHTML = '';
      contacts.forEach(ct => {
        const li = document.createElement('li');
        li.className = 'contact' + (activeContact?.id === ct.id ? ' active' : '');
        li.dataset.id = ct.id;
        li.innerHTML = `
          <img src="${ct.avatar}" alt="">
          <div class="info">
            <h3>${ct.name}</h3>
          </div>
        `;
        li.onclick = () => selectContact(ct.id);
        $contactsList.append(li);
      });
    }

    // --- Select a Contact & Listen for Their Messages ---
    function selectContact(id) {
      activeContact = contacts.find(c => c.id === +id);
      $chatName.textContent   = activeContact.name;
      $chatStatus.textContent = activeContact.status;
      $avatar.src             = activeContact.avatar;
      $chatBody.innerHTML     = '';

      // Stop previous listener by resetting chat-body
      // Listen for new messages under node `chats/{contactId}`
      const chatRef = ref(db, `chats/${activeContact.id}`);
      onChildAdded(chatRef, snap => {
        const msg = snap.val();
        appendMessage(msg);
      });

      renderContacts();
    }

    // --- Append Message to DOM ---
    function appendMessage(msg) {
      const div = document.createElement('div');
      div.className = 'message ' + (msg.sender === 'me' ? 'sent' : 'received');
      div.textContent = msg.text;
      const ts = document.createElement('span');
      ts.className = 'timestamp';
      ts.textContent = new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      div.append(ts);
      $chatBody.append(div);
      $chatBody.scrollTop = $chatBody.scrollHeight;
    }

    // --- Send Message ---
    function sendMessage() {
      const text = $messageInput.value.trim();
      if (!text || !activeContact) return;
      const chatRef = ref(db, `chats/${activeContact.id}`);
      push(chatRef, {
        sender: 'me',
        text,
        timestamp: Date.now()
      });
      $messageInput.value = '';
    }

    // --- Event Listeners ---
    $sendBtn.addEventListener('click', sendMessage);
    $search.addEventListener('input', e => {
      const q = e.target.value.toLowerCase();
      document.querySelectorAll('.contact').forEach(li => {
        const name = li.querySelector('h3').textContent.toLowerCase();
        li.style.display = name.includes(q) ? '' : 'none';
      });
    });
    $newChat.addEventListener('click', () => {
      const name = prompt('New contact name:');
      if (!name) return;
      const id = contacts.length + 1;
      contacts.unshift(new Contact(id, name, `https://i.pravatar.cc/150?img=${id+5}`));
      renderContacts();
    });

    // --- Init ---
    renderContacts();
  </script>
</body>
</html>
